Findings

High — PAM cleanup crash: _authenticate always awaits auth.close() even if BluSec2Authenticator construction failed, so auth can be None and this raises AttributeError, masking the real init error and causing PAM to fail noisily. See pam_blusec2.py (line 115) and pam_blusec2.py (line 143).
High — PAM password parsing is wrong: _read_password only strips \n, but pam_exec sends a NUL-terminated token, so the password is likely password\x00 and will never verify. See pam_blusec2.py (line 78) and pam_blusec2.py (line 79).
High — Race drops valid responses: wait_for_authentication rotates the challenge and then clears auth_event and last_response. If the device responds quickly between those steps, the response is discarded and auth times out. See blusec2_gate_server.py (line 277), blusec2_gate_server.py (line 280), and blusec2_gate_server.py (line 281).
High — Background rotation can break auth: challenge_rotation_task can rotate current_challenge while wait_for_authentication is waiting, so valid responses for the previous challenge will fail. The example main() starts rotation before waiting, making failures nondeterministic. See blusec2_gate_server.py (line 191), blusec2_gate_server.py (line 347), and blusec2_gate_server.py (line 298).
Medium — RSSI can be None: Bleak may report device.rssi=None, and rssi >= threshold will raise TypeError (the %d log format will also fail). See blusec2_gate_server.py (line 218) and blusec2_gate_server.py (line 219).
Medium — Gate server can’t restart on the same authenticator: stop() leaves self.server non-None, but authenticate() only starts the server when it’s None. A second auth attempt after close() on the same instance won’t restart the server. See blusec2_gate_server.py (line 150) and blusec2_auth.py (line 152).
Medium — BLUSEC2_TIMEOUT doesn’t actually extend BLE wait: PAM wraps auth.authenticate() with AUTH_TIMEOUT, but wait_for_authentication() always uses its default 30.0 because the timeout isn’t passed through. Longer timeouts still fail around 30 seconds. See pam_blusec2.py (line 42), pam_blusec2.py (line 127), blusec2_auth.py (line 156), and blusec2_gate_server.py (line 247).
Medium — Installer hard-codes the PAM helper path: the snippet uses /usr/local/bin/blusec2-pam, but install.sh doesn’t rewrite it to the actual command -v path. If pip installs elsewhere, PAM will call a non-existent binary. See blusec2-auth (line 26) and install.sh (line 78).
Low — Challenge interval is duplicated: challenge_rotation_task hardcodes interval=11 instead of using CHALLENGE_INTERVAL, so changing the crypto interval won’t update rotation. See blusec2_gate_server.py (line 191) and blusec2_crypto.py (line 19).
Low — Docs vs behavior mismatch: README says challenges rotate every 11 seconds, but the normal authenticate() flow never starts the rotation task, so challenges only rotate once per auth attempt. See README.md (line 24), README.md (line 38), and blusec2_auth.py (line 151).